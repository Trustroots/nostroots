services:
  tests:
    build:
      context: ..
      dockerfile: nr-web/Dockerfile
    volumes:
      # Mount source code for development (allows code changes without rebuild)
      - .:/app/nr-web
      # Mount node_modules from container to avoid permission issues
      - test-node-modules:/app/nr-web/node_modules
    working_dir: /app/nr-web
    # Default command runs all tests
    command: pnpm test:local:all
    # Environment variables
    environment:
      - CI=${CI:-false}
    # Expose ports for E2E test server and Vitest UI
    ports:
      - "8080:8080"   # E2E test server
      - "51204:51204" # Vitest UI (if needed)
    # Use bridge network (default) - works better than host mode in most environments

volumes:
  test-node-modules:
